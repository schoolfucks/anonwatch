<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AnonTube via File</title>
  <style>
    body { font-family: sans-serif; background: #111; color: #fff; padding: 2rem; }
    input, button { width: 100%; padding: 0.5rem; margin: 0.5rem 0; }
    iframe { width: 100%; height: 360px; margin-top: 1rem; border: none; }
    .video-item { margin-bottom: 1rem; }
  </style>
</head>
<body>
  <h1>ðŸ“¼ File-Based YouTube Share</h1>
  <input type="text" id="youtubeUrl" placeholder="Paste YouTube link" />
  <button onclick="uploadVideo()">Upload</button>
  <div id="videoList"><h2>ðŸ“º Shared Videos</h2></div>

  <script>
    const API = '/videos';

    function extractVideoId(url) {
      const match = url.match(/(?:v=|\/)([0-9A-Za-z_-]{11})(?:&|$)/);
      return match ? match[1] : null;
    }

    async function uploadVideo() {
      const input = document.getElementById("youtubeUrl");
      const videoId = extractVideoId(input.value.trim());
      if (!videoId) return alert("Invalid URL");

      await fetch(API, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ videoId })
      });

      input.value = '';
      loadVideos();
    }

    async function loadVideos() {
      const res = await fetch(API);
      const videos = await res.json();
      const list = document.getElementById("videoList");
      list.innerHTML = "<h2>ðŸ“º Shared Videos</h2>";

      videos.forEach(id => {
        const div = document.createElement("div");
        div.className = "video-item";
        div.innerHTML = `<iframe src="https://inv.nadeko.net/embed/${id}" allowfullscreen></iframe>`;
        list.appendChild(div);
      });
    }

    loadVideos();
  </script>
</body>
</html>
